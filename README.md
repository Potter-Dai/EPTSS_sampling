EPTSS_sampling
=================


The repository documents how to perform Environmental Perturbation Transition State Sampling to evaluate the single-molecule time-resolved reaction pathways in condensed media. The model reaction is an enzyme-catalysed pericyclic reaction. In 2017, the Yi Tang group published evidence for the first monofunctional Hetro-Diels–Alderase, LepI, in the biosynthetic pathway of Leporin B. We discovered later that the reaction bifurcates to the IMDA and HDA adduct through a single ambimodal transition state. We now elucidate in detail the mechanism of the reaction and show how the LepI enzyme dynamically controls product formation. Our method will find great application in the design of enzymes to control selectivity, particularly for reactions involving ambimodal transition states.
The environment-perturbed transition-state sampling method has been developed to calculate free energies, kinetic isotope effects, and quasi-classical reaction trajectories of enzyme-catalyzed reactions and the uncatalyzed reaction in water. 

![image](https://user-images.githubusercontent.com/69182867/144348641-b1b9bff1-ba1d-4c7d-bf98-13bf343bfbba.png)


EPTSS sampling in water, tutorial 
------------------------------------


Solution-phase dynamics simulations were performed by interfacing Gaussian 09 and Amber 18, the following description details how to perform EPTSS for exploring the dynamics of bifcurcation PES reactions in aqueous solution. 
## Step 1. Construction of Solution Box and Equilibration
--------------------------------------------------------
TS is surrounded with a cubic solvent box (periodic boundary conditions, electrostatic cutoff is 8 Å). PRMTOP and INPCRD files were generated by using AMBERTools 18, which record the topology  and coordinates of the solution box respectively. For a given box size and with TSw fixed (ibelly=1 in AMBER input), the solvent is equilibrated for 200 ps in an NPT ensemble. Langevin thermostat was used for maintaining temperature with pseudo collision frequency set as 5 ps-1(ntt=3, gamma=5). Here is the amber MD production run input file:
```bash
sh run_solv_boo.sh
```
## Step 2. Extraction of Various Solvent Configurations
As solvent equilibration continues with fixed TSw, a set of instantaneous frozen solvent coordinates and momenta are randomlly extracted and stored as RST files. 
1. Use python to generate random number, and then use rst.sh to generate randomly picked snapshort
```bash
python ran_number.py
sh rst.sh 
```
## Step 3. Optimization of Solvent Perturbed Transition Structures
After we got the transformed amber rst files, we need to transform them to gaussian input files
1. construction of a template com file, before that we need a tempalte list file
```bash
python rst2com.py 
```
2. generation of coms files
```bash
sh COMs.sh
```
The input files was complemented by opening it in GaussView and saving it. This was to generate the connectivity below the coordinate. Last but not the least, since the command freq=selectnormalmodes was used to calculate the frequencies of the N1 atoms in QM region, we had to put a sentence “atom=1-N1”, in the end of the input file (one blank line after the connectivity).
## Step 4. Solvent Perturbed Transition State Normal Mode Sampling
After TS optzimation using gaussian, at each EPTS saddle point, 4 initial coordinates and momenta are sampled quasi classically by TS normal mode sampling at 300 K. Here we use a customized Progdyn for TS normal mode sampling. This gives initial conditions for 4×NSPTS trajectories.
1. Use Extractout.py to extract the coordinate and frequency
```bash 
python Extractout.py 
```
2. Use g09.sh, sampling.sh, revisefreq.py, proggenHP, and progdyn.conf to initialize the sampling.
```bash
sh sampling.sh
```
3. The newly sampled files are called GeoPlusVel followed by an index. These files were transformed back to RST files by using GeoVel.py.
```bash
python GeoVel.py
```
## Step 5. Quasi-classical trajectory production run
All constraints on the frozen solvent zone are released, and 4 NSPTS trajectories for the full system are propagated forward and backward from the initial point until either reactants or products are formed, using velocity Verlet with a 1 fs step size. In the current application, trajectories were stopped after 200 fs in each direction
```bash 
sh job_split.sh 
```
This is the turtorial of EPTSS sampling in water, another turtorial in enzyme LepI is in prepartation...
